{% extends 'base.html' %}

{% load static %}

{% block content %}

    <h2 style="margin-left: 20px;">MANAGE SHOPPING LIST(S)</h2>

    {% if messages %}
     {% for message in messages %}
            {{ message }}
        {% endfor %}
    {% endif %}


    <div class="sl_dropdown">
        <button class="sl_dropbtn">Shopping Lists</button>
        <div class="sl_dropdown-content">
            {% for list in UserListID %}
                <a href="{% url 'shopping_lists_with_id' list_id=list.ListID %}">{{ list.ListName }}</a>
            {% endfor %}
        </div>
        </div>
    <br><br>

    <!--Display chosen shopping list heading, if no list exists, display you have no lists-->
    <!--Display chosen shopping list items-->
	<center>
    {% if selected_list_id %}
	        <h2>{{ selected_list.ListName }}</h2>
		<table border="1" class="custom-table">
		<thead>
			<tr>
				<th class="custom-table-th">Ingredient Name</th>
				<th class="custom-table-th">Store</th>
				<th class="custom-table-th">Price</th>
				<th class="custom-table-th">Quantity</th>
				<th class="custom-table-th">Remove Item</th>
			</tr>
		</thead>
		<tbody>
        {% for item in shopping_list_items %}
			<tr class="custom-hover-tr">
				<td class="custom-table-td"><a href="{% url 'ingredient_detail' IngredientID=item.Ingredient.IngredientID %}">{{ item.Ingredient.IngredientName }}</a></td>
				<td class="custom-table-td">{{ item.StoreID.StoreName }}</td>
				{% for price in current_prices %}
					{% if price.IngredientID_id == item.Ingredient_id and price.StoreID_id == item.StoreID_id %}
						<td class="custom-table-td">{{ price.CurrentPrice }}</td>
					{% endif %}
				{% endfor %}
				<td class="custom-table-td">{{ item.Quantity }}</td>
				<td class="custom-table-td">
					<form method="post" action="{% url 'remove_item_from_list' %}">
						{% csrf_token %}
						<input type="hidden" name="ingredient_id" value="{{ item.Ingredient.IngredientID }}">
					    <input type="hidden" name="list_id" value="{{ selected_list.ListID }}">
						<button type="submit">Remove Item</button>
					</form>
				</td>
			</tr>
        {% endfor %}
			</tbody>
			</table>
    {% else %}
    <p>You have not selected a shopping list.</p>
    </center>
    {% endif %}

    <!--To the right allow a user to add a new shopping list, with placeholder - Add new Shopping List-->
    <form method="post" action="{% url 'shopping_lists' %}">
        {% csrf_token %}
          <input type="text" placeholder="Enter New Shopping List Name..." name="shopping_list_name">
         <button type="submit">Submit</button>
    </form>


{% endblock %}